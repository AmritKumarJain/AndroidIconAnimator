<div class="studio-layer-timeline">
  <studio-splitter edge="top" min="200" persist-id="layer-timeline"></studio-splitter>

  <div class="slt-layers" layout="column">
    <studio-splitter edge="right" min="100" persist-id="layer-list"></studio-splitter>

    <div class="slt-header" layout="row" layout-align="start center">
      <md-menu md-offset="0 40">
        <button class="slt-layers-menu-group-button" ng-click="$mdOpenMenu()">
          Export
        </button>
        <md-menu-content>
          <md-menu-item>
            <md-button ng-click="ctrl.onExportJSON($event)">
              Export JSON
            </md-button>
          </md-menu-item>
          <md-menu-item>
            <md-button ng-click="ctrl.onExportAVDs($event)">
              Export Animated Vector Drawable(s)
            </md-button>
          </md-menu-item>
        </md-menu-content>
      </md-menu>
      </md-toolbar>
      <div flex></div>
      <md-menu class="slt-add-layer-menu">
        <md-button
            class="md-icon-button"
            ng-click="$mdOpenMenu($event)">
          <md-icon md-svg-icon="avdstudio:add_layer"></md-icon>
        </md-button>
        <md-menu-content>
          <md-menu-item><md-button ng-click="ctrl.onAddLayer($event, 'layer')">
            Path
          </md-button></md-menu-item>
          <md-menu-item><md-button ng-click="ctrl.onAddLayer($event, 'mask')">
            Clip path
          </md-button></md-menu-item>
          <md-menu-item><md-button ng-click="ctrl.onAddLayer($event, 'group')">
            Layer group
          </md-button></md-menu-item>
        </md-menu-content>
      </md-menu>
    </div>

    <div class="slt-layers-list-scroller" scroll-group="timeline">
      <div class="slt-layers-list">
        <div class="slt-layer-container"
            data-layer-id="{{layer.id}}"
            ng-repeat="layer in ctrl.artwork.layers"
            ng-include="'layerListItem'"
            layout="column"></div>
      </div>
    </div>

    <script type="text/ng-template" id="layerListItem">
      <div
          class="slt-layer slt-layer-type-{{ layer._slt.layerType }}"
          ng-class="{'is-selected': layer.selected_}"
          ng-click="ctrl.onLayerClick($event, layer)"
          ng-mousedown="ctrl.onLayerMouseDown($event, layer)"
          layout="row">
        <md-icon md-svg-icon="avdstudio:{{ layer._slt.icon }}"></md-icon>
        <span flex class="slt-layer-id">{{ layer.id }}</span>
        <md-menu class="slt-layer-add-property-menu" ng-if="ctrl.activeAnimation">
          <md-button
              class="md-icon-button"
              ng-click="$mdOpenMenu($event)">
            <md-icon md-svg-icon="avdstudio:animation_block"></md-icon>
          </md-button>
          <md-menu-content>
            <md-menu-item ng-repeat="(propertyName, __) in layer._slt.availableProperties">
              <md-button ng-click="ctrl.onAddTimelineBlock($event, layer, propertyName,
                                                           ctrl.activeAnimation)">
                {{propertyName}}
              </md-button>
            </md-menu-item>
          </md-menu-content>
        </md-menu>
      </div>
      <div class="slt-properties"><div
            class="slt-property"
            ng-repeat="(property, __) in layer._slt.blocksByProperty">{{property}}</div></div>
      <ul class="slt-children" ng-if="layer.layers">
        <li class="slt-layer-container"
            ng-repeat="layer in layer.layers"
            data-layer-id="{{layer.id}}"
            ng-include="'layerListItem'"
            layout="column"></li>
      </ul>
    </script>

  </div>
  <div class="slt-timeline">
    <div
        class="slt-timeline-animation"
        ng-class="{'is-active': ctrl.activeAnimation == animation}"
        ng-mousedown="ctrl.onAnimationMouseDown($event, animation)"
        style="width: {{animation.duration * ctrl.horizZoom + 40}}px"
        ng-repeat="animation in ctrl.animations"
        layout="column">

      <div
          class="slt-header">
        <div
            class="slt-timeline-animation-meta"
            ng-class="{'is-selected': animation.selected_}"
            ng-click="ctrl.onAnimationHeaderClick($event, animation)">
          <span class="slt-timeline-animation-name">{{animation.id}}</span>
          <span class="slt-timeline-animation-duration">{{animation.duration}}ms</span>
        </div>
        <studio-timeline-grid
            class="slt-timeline-header-grid"
            is-header
            is-active="ctrl.activeAnimation == animation"
            active-time="ctrl.activeTime"
            animation="animation"
            on-scrub="ctrl.onTimelineHeaderScrub(animation, time)">
        </studio-timeline-grid>
      </div>

      <studio-timeline-grid
          class="slt-timeline-grid"
          is-active="ctrl.activeAnimation == animation"
          active-time="ctrl.activeTime">
      </studio-timeline-grid>

      <div class="slt-timeline-animation-scroller" scroll-group="timeline">
        <div class="slt-timeline-animation-rows">
          <div ng-repeat="layer in ctrl.artwork.layers" ng-include="'timelineRow'"></div>
        </div>
      </div>

      <script type="text/ng-template" id="timelineRow">
        <div class="slt-layer slt-layer-type-{{ layer._slt.layerType }}"></div>

        <div class="slt-properties"><div
              class="slt-property"
              ng-repeat="(property, blocks) in layer._slt.blocksByProperty">
          <div
              class="slt-timeline-block"
              ng-class="{'is-selected': block.selected_}"
              ng-click="ctrl.onTimelineBlockClick($event, block, animation, layer)"
              ng-mousedown="ctrl.onTimelineBlockMouseDown($event, block, animation, layer)"
              ng-repeat="block in blocks[animation.id]"
              tabindex="-1"
              style="left: {{100 * block.startTime / animation.duration}}%;
                     width: {{100 * (block.endTime - block.startTime) / animation.duration}}%">
            <div class="slt-timeline-block-edge slt-timeline-block-edge-start"></div>
            <div class="slt-timeline-block-edge slt-timeline-block-edge-end"></div>
          </div>
        </div></div>

        <ul class="slt-children" ng-if="layer.layers">
          <li ng-repeat="layer in layer.layers" ng-include="'timelineRow'"></li>
        </ul>
      </script>

    </div>

    <div layout="row" layout-align="start stretch">
      <div
          class="slt-timeline-animation-new-container"
          layout="column"
          layout-align="center center">
        <div
            ng-click="ctrl.onAddNewAnimation()"
            class="slt-timeline-animation-new"
            layout="column"
            layout-align="center center">
          <md-icon md-svg-icon="avdstudio:add_animation"></md-icon>
          <span>New animation</span>
        </div>
      </div>
    </div>
  </div>
</div>